<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SigmaSaur Arcade</title>
    <!-- Fuente Pixelada Retro -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --cabinet-color: #1a1a1a;
            --cabinet-side: #2d2d2d;
            --t-molding: #ff00ff; /* Rosa neón */
            --screen-glow: 0 0 20px rgba(57, 255, 20, 0.3);
            --neon-green: #39ff14;
            --neon-blue: #00ffff;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #050505;
            background-image: 
                radial-gradient(circle at 20% 20%, #220022 5%, transparent 10%),
                radial-gradient(circle at 80% 80%, #001122 5%, transparent 10%);
            background-size: 50px 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Press Start 2P', cursive;
            overflow: hidden;
            color: white;
            user-select: none;
        }

        /* --- Estructura del Mueble Arcade --- */
        .arcade-cabinet {
            position: relative;
            width: 860px;
            background-color: var(--cabinet-color);
            border-radius: 20px 20px 0 0;
            border: 8px solid var(--t-molding);
            box-shadow: 0 0 50px rgba(255, 0, 255, 0.2), inset 0 0 30px #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .marquee {
            width: 95%;
            height: 80px;
            background: linear-gradient(to bottom, #440044, #220022);
            border: 4px solid #fff;
            box-shadow: 0 0 15px #ff00ff;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .marquee h1 {
            color: var(--neon-blue);
            font-size: 35px;
            text-shadow: 
                3px 3px 0px #ff00ff,
                0 0 20px var(--neon-blue);
            margin: 0;
            letter-spacing: 5px;
            z-index: 2;
            text-transform: uppercase;
            font-style: italic;
        }

        .marquee::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.2) 50%, transparent 60%);
            z-index: 1;
        }

        .screen-bezel {
            position: relative;
            padding: 20px;
            background-color: #000;
            border-radius: 10px;
            box-shadow: inset 0 0 20px rgba(255,255,255,0.1);
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 400px;
            background-color: #200f21;
            border: 2px solid #333;
            overflow: hidden;
            box-shadow: var(--screen-glow);
        }

        .speakers {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 10px;
            padding: 0 50px;
            box-sizing: border-box;
        }
        .speaker-grill {
            width: 80px;
            height: 40px;
            background-image: radial-gradient(#333 30%, transparent 31%);
            background-size: 4px 4px;
            border-radius: 5px;
            border: 1px solid #444;
        }
        .controls-deco {
            color: #666;
            font-size: 10px;
            text-align: center;
            margin-top: 10px;
            text-transform: uppercase;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .scanlines {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 10;
        }

        .ui-screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 20;
        }

        .hidden { display: none !important; }

        .score-display {
            position: absolute;
            top: 20px; right: 20px;
            font-size: 16px;
            z-index: 5;
            text-shadow: 2px 2px 0 #000;
        }
        .high-score { color: var(--t-molding); margin-right: 15px; }

        button {
            background-color: var(--neon-green);
            color: #000;
            border: none;
            padding: 15px 30px;
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            cursor: pointer;
            margin: 10px;
            box-shadow: 4px 4px 0px var(--t-molding);
        }
        button:hover { transform: scale(1.05); background-color: #fff; }
        button.btn-exit { background-color: #ff3333; }

        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        .joystick-panel {
            display: flex;
            gap: 20px;
            margin-top: 5px;
            align-items: center;
        }
        .joy-ball {
            width: 30px; height: 30px; background: red; border-radius: 50%;
            box-shadow: -2px -2px 5px rgba(0,0,0,0.5) inset;
        }
        .arcade-btn {
            width: 25px; height: 25px; border-radius: 50%;
            box-shadow: 0 3px 0 #333;
        }
        .btn-a { background: blue; } .btn-b { background: green; }

    </style>
</head>
<body>

    <div class="arcade-cabinet">
        <div class="marquee">
            <h1>SigmaSaur</h1>
        </div>

        <div class="speakers">
            <div class="speaker-grill"></div>
            <div class="speaker-grill"></div>
        </div>

        <div class="screen-bezel">
            <div id="game-container">
                <div class="scanlines"></div>
                <canvas id="gameCanvas" width="800" height="400"></canvas>

                <div class="score-display">
                    <span id="hi-score-display" class="high-score">HI: 00000</span>
                    <span id="current-score">00000</span>
                </div>

                <div id="start-screen" class="ui-screen">
                    <h1 style="color: var(--neon-green); text-shadow: 3px 3px #ff00ff; font-size: 24px;">INSERT COIN</h1>
                    <div style="color: cyan; border: 2px dashed cyan; padding: 15px; margin: 20px; font-size: 10px; line-height: 1.6;">
                        CONTROLES:<br>
                        [ESPACIO/ARRIBA] - SALTAR<br>
                        [ABAJO/S] - AGACHARSE
                    </div>
                    <p class="blink">PRESIONA CUALQUIER TECLA</p>
                </div>

                <div id="game-over-screen" class="ui-screen hidden">
                    <h1 style="color: red; font-size: 40px;">GAME OVER</h1>
                    <div id="new-record-msg" class="hidden" style="color: yellow; margin-bottom: 10px;">¡NUEVO RÉCORD!</div>
                    <p>SCORE: <span id="final-score">0</span></p>
                    <div>
                        <button onclick="resetGame()">RETRY</button>
                        <button class="btn-exit" onclick="exitGame()">EXIT</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls-deco">
            <div class="joystick-panel">
                <div style="display:flex; flex-direction:column; align-items:center;">
                    <div class="joy-ball"></div>
                    <div style="width:10px; height:20px; background:#555;"></div>
                </div>
                <div>STEREO SOUND SYSTEM</div>
                <div class="arcade-btn btn-a"></div>
                <div class="arcade-btn btn-b"></div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const currentScoreEl = document.getElementById('current-score');
        const hiScoreEl = document.getElementById('hi-score-display');
        const finalScoreEl = document.getElementById('final-score');
        const newRecordMsg = document.getElementById('new-record-msg');

        // Estados del juego
        let gameRunning = false;
        let gameSpeed = 6;
        let score = 0;
        let highScore = localStorage.getItem('sigmaSaurHi') || 0;
        let frame = 0;
        let spawnTimer = 0;
        let obstacles = [];
        let decorations = [];

        hiScoreEl.innerText = `HI: ${Math.floor(highScore).toString().padStart(5, '0')}`;

        // Objeto Jugador (Dino rediseñado)
        const dino = {
            x: 50,
            y: 280,
            originalWidth: 50,
            originalHeight: 70,
            width: 50,
            height: 70,
            dy: 0,
            jumpPower: -13,
            gravity: 0.7,
            grounded: false,
            crouching: false,
            color: '#39ff14',
            
            draw: function() {
                // NUEVO DISEÑO DE PERSONAJE
                ctx.fillStyle = this.color;
                
                if (this.crouching) {
                    // DIBUJO AGACHADO (Forma alargada)
                    // Cuerpo central
                    ctx.fillRect(this.x, this.y + 20, 60, 25);
                    // Cola (atrás)
                    ctx.fillRect(this.x - 20, this.y + 25, 20, 10);
                    // Cabeza (adelante baja)
                    ctx.fillStyle = '#2dbd0f';
                    ctx.fillRect(this.x + 60, this.y + 20, 25, 25);
                    // Ojo
                    ctx.fillStyle = '#000';
                    ctx.fillRect(this.x + 75, this.y + 25, 5, 5);
                    // Patas (encogidas)
                    ctx.fillStyle = '#2dbd0f';
                    ctx.fillRect(this.x + 10, this.y + 45, 15, 5); // Trasera
                    ctx.fillRect(this.x + 40, this.y + 45, 15, 5); // Delantera
                } else {
                    // DIBUJO DE PIE (Forma "Kaiju" / T-Rex agresivo)
                    
                    // Cola (curva hacia arriba para balance)
                    ctx.fillRect(this.x - 20, this.y + 20, 20, 15);
                    ctx.fillRect(this.x - 25, this.y + 10, 10, 10); // Punta cola

                    // Cuerpo (Robusto)
                    ctx.fillRect(this.x, this.y + 10, 50, 45);
                    
                    // Cabeza (Más grande y cuadrada)
                    ctx.fillStyle = '#2dbd0f';
                    ctx.fillRect(this.x + 20, this.y - 15, 45, 40);
                    
                    // Hocico/Mandíbula
                    ctx.fillStyle = '#39ff14';
                    ctx.fillRect(this.x + 65, this.y, 10, 25);

                    // Ojo
                    ctx.fillStyle = '#000';
                    ctx.fillRect(this.x + 50, this.y - 5, 6, 6);
                    
                    // Brazos (Garras rosas)
                    ctx.fillStyle = '#ff00ff'; 
                    ctx.fillRect(this.x + 50, this.y + 30, 15, 6);
                    ctx.fillRect(this.x + 60, this.y + 36, 4, 6); // Garra abajo

                    // Patas (Animación de correr)
                    ctx.fillStyle = '#2dbd0f';
                    if (Math.floor(frame / 8) % 2 === 0) {
                        ctx.fillRect(this.x + 5, this.y + 55, 18, 15); // Pata trasera piso
                        ctx.fillRect(this.x + 35, this.y + 50, 18, 10); // Pata delantera aire
                    } else {
                        ctx.fillRect(this.x + 5, this.y + 50, 18, 10); // Pata trasera aire
                        ctx.fillRect(this.x + 35, this.y + 55, 18, 15); // Pata delantera piso
                    }
                }
            },
            jump: function() {
                if (this.grounded && !this.crouching) {
                    this.dy = this.jumpPower;
                    this.grounded = false;
                }
            },
            crouch: function(isDown) {
                if(isDown) {
                    if (!this.crouching) {
                        this.crouching = true;
                        this.height = 35; 
                        this.width = 70; 
                        if (!this.grounded) this.dy += 5; 
                    }
                    if (this.grounded) this.y = 350 - this.height;
                } else {
                    if (this.crouching) {
                        this.crouching = false;
                        this.height = this.originalHeight;
                        this.width = this.originalWidth;
                        this.y = 350 - this.height;
                    }
                }
            },
            update: function() {
                if (!gameRunning) return;
                this.dy += this.gravity;
                this.y += this.dy;

                // Colisión Suelo
                if (this.y + this.height > 350) {
                    this.y = 350 - this.height;
                    this.dy = 0;
                    this.grounded = true;
                } else {
                    this.grounded = false;
                }
            }
        };

        // Obstáculos
        class Obstacle {
            constructor(type) {
                this.x = canvas.width;
                this.markedForDeletion = false;
                this.type = type;

                if (type === 'tronco') {
                    this.width = 40; this.height = 30;
                    this.y = 350 - this.height;
                    this.color = '#8B4513';
                } else if (type === 'muro') {
                    this.width = 30; this.height = 70;
                    this.y = 350 - this.height;
                    this.color = '#777';
                } else if (type === 'avion') {
                    this.width = 60; 
                    this.height = 30;
                    this.y = 275; 
                    this.color = '#55aaff';
                }
            }
            update() {
                this.x -= gameSpeed;
                if (this.x + this.width < -50) this.markedForDeletion = true;
            }
            draw() {
                if (this.type === 'avion') {
                    ctx.fillStyle = '#ccc';
                    ctx.beginPath();
                    ctx.ellipse(this.x + 30, this.y + 15, 30, 10, 0, 0, Math.PI * 2); 
                    ctx.fill();
                    ctx.fillStyle = '#ff3333';
                    ctx.fillRect(this.x + 15, this.y + 5, 25, 5);
                    ctx.fillStyle = '#fff';
                    if (frame % 4 < 2) ctx.fillRect(this.x - 5, this.y + 5, 5, 20);
                } else if (this.type === 'tronco') {
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                    ctx.fillStyle = '#5c3a1e';
                    ctx.fillRect(this.x + 5, this.y + 5, 10, 20);
                } else { // Muro
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                    ctx.strokeStyle = '#000';
                    ctx.strokeRect(this.x, this.y, this.width, this.height);
                }
            }
        }

        class Decoration {
            constructor(type) {
                this.x = canvas.width;
                this.type = type;
                this.markedForDeletion = false;
                
                if (type === 'nube') {
                    this.y = Math.random() * 80 + 20; 
                    this.size = Math.random() * 30 + 30;
                    this.speedModifier = 0.3;
                } else if (type === 'arbol_lejos') {
                    this.y = 350;
                    this.size = Math.random() * 40 + 40;
                    this.speedModifier = 0.6;
                }
            }
            update() {
                this.x -= gameSpeed * this.speedModifier;
                if (this.x + 100 < -100) this.markedForDeletion = true;
            }
            draw() {
                if (this.type === 'nube') {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.15)';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.arc(this.x + this.size * 0.8, this.y + 10, this.size * 0.8, 0, Math.PI * 2);
                    ctx.fill();
                } else if (this.type === 'arbol_lejos') {
                    ctx.fillStyle = '#112211'; 
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x + this.size/2, this.y - this.size * 2);
                    ctx.lineTo(this.x + this.size, this.y);
                    ctx.fill();
                }
            }
        }

        // --- Sistema ---

        function startGame() {
            if (gameRunning) return;
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            newRecordMsg.classList.add('hidden');
            
            gameRunning = true;
            score = 0;
            gameSpeed = 7;
            obstacles = [];
            decorations = [];
            spawnTimer = 0;
            dino.y = 280;
            dino.dy = 0;
            dino.crouch(false);
            
            animate();
        }

        function resetGame() {
            startGame();
        }

        function exitGame() {
            if(confirm("¿SALIR DEL JUEGO?")) {
                window.close();
                document.body.innerHTML = "<div style='color:white; text-align:center;'><h1>SISTEMA APAGADO</h1></div>";
            }
        }

        function checkCollision(player, obs) {
            const paddingX = 8; 
            const paddingY = 2; 

            return (
                player.x + paddingX < obs.x + obs.width - paddingX &&
                player.x + player.width - paddingX > obs.x + paddingX &&
                player.y + paddingY < obs.y + obs.height - paddingY &&
                player.y + player.height - paddingY > obs.y + paddingY
            );
        }

        function gameOver() {
            gameRunning = false;
            let isNewRecord = false;
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('sigmaSaurHi', highScore);
                isNewRecord = true;
            }
            finalScoreEl.innerText = Math.floor(score);
            hiScoreEl.innerText = `HI: ${Math.floor(highScore).toString().padStart(5, '0')}`;
            if(isNewRecord) newRecordMsg.classList.remove('hidden');
            gameOverScreen.classList.remove('hidden');
        }

        function animate() {
            if (!gameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Fondo Cielo Gradiente
            let gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, "#200f21");
            gradient.addColorStop(1, "#442244");
            ctx.fillStyle = gradient;
            ctx.fillRect(0,0, canvas.width, canvas.height);

            // --- NUEVO DISEÑO DE SUELO (TIERRA) ---
            // Base Tierra
            ctx.fillStyle = '#4a3c31'; // Café tierra oscuro
            ctx.fillRect(0, 350, canvas.width, 50);
            
            // Línea de pasto superior
            ctx.fillStyle = '#2d8a2d'; // Verde oscuro
            ctx.fillRect(0, 350, canvas.width, 5);

            // Textura de tierra que se mueve
            ctx.fillStyle = '#2e241d'; // Rocas oscuras
            for(let i=0; i<canvas.width; i+=60) {
                // Calcular posición basada en velocidad para efecto de movimiento
                let offset = (i - frame * gameSpeed) % canvas.width;
                if(offset < 0) offset += canvas.width;
                
                // Dibujar detalles de tierra aleatorios pero consistentes
                ctx.fillRect(offset, 365, 6, 6); 
                ctx.fillRect(offset + 25, 380, 4, 4);
                ctx.fillRect(offset + 10, 390, 8, 3);
            }

            score += 0.05;
            gameSpeed += 0.0003; 
            currentScoreEl.innerText = Math.floor(score).toString().padStart(5, '0');

            // Decoración
            if (Math.random() < 0.02) decorations.push(new Decoration('nube'));
            if (Math.random() < 0.04) decorations.push(new Decoration('arbol_lejos'));

            decorations.forEach((d, index) => {
                d.update(); d.draw();
                if (d.markedForDeletion) decorations.splice(index, 1);
            });

            // Obstáculos
            spawnTimer--;
            if (spawnTimer <= 0) {
                const types = ['tronco', 'muro', 'avion', 'avion']; 
                const randomType = types[Math.floor(Math.random() * types.length)];
                obstacles.push(new Obstacle(randomType));
                spawnTimer = (Math.random() * 40 + 50) - (gameSpeed * 1.5);
                if (spawnTimer < 35) spawnTimer = 35;
            }

            obstacles.forEach((obs, index) => {
                obs.update(); obs.draw();
                if (checkCollision(dino, obs)) gameOver();
                if (obs.markedForDeletion) obstacles.splice(index, 1);
            });

            dino.update();
            dino.draw();

            frame++;
            requestAnimationFrame(animate);
        }

        function handleInput(e) {
            if (!gameRunning) {
                if ((e.code || e.type === 'mousedown') && !startScreen.classList.contains('hidden')) startGame();
                return;
            }
            if (e.type === 'keydown') {
                if (e.code === 'Space' || e.code === 'ArrowUp') dino.jump();
                if (e.code === 'ArrowDown' || e.code === 'KeyS') dino.crouch(true);
            } else if (e.type === 'keyup') {
                if (e.code === 'ArrowDown' || e.code === 'KeyS') dino.crouch(false);
            } else if (e.type === 'mousedown' || e.type === 'touchstart') {
                const clientY = e.clientY || e.touches[0].clientY;
                if (clientY > window.innerHeight / 2) dino.crouch(true);
                else dino.jump();
            } else if (e.type === 'mouseup' || e.type === 'touchend') {
                dino.crouch(false);
            }
        }

        window.addEventListener('keydown', handleInput);
        window.addEventListener('keyup', handleInput);
        canvas.addEventListener('mousedown', handleInput);
        canvas.addEventListener('mouseup', handleInput);
        canvas.addEventListener('touchstart', (e)=>{e.preventDefault(); handleInput(e)}, {passive:false});
        canvas.addEventListener('touchend', (e)=>{e.preventDefault(); handleInput(e)});

        function initialDraw() {
            ctx.fillStyle = '#200f21'; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = '#4a3c31'; ctx.fillRect(0, 350, canvas.width, 50); // Suelo tierra inicial
            ctx.fillStyle = '#2d8a2d'; ctx.fillRect(0, 350, canvas.width, 5); // Pasto inicial
            dino.draw();
        }
        initialDraw();

    </script>
</body>
</html>